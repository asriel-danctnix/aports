# Contributor: Boris Faure <boris@fau.re>
# Contributor: Danct12 <danct12@disroot.org>
# Contributor: Asriel Dreemurr <asriel.danctnix@gmail.com>
# Maintainer: Boris Faure <boris@fau.re>
pkgname=efl
pkgver=1.22.2
pkgrel=0
pkgdesc="Enlightenment Foundation Libraries"
url="https://www.enlightenment.org"
arch="all !s390x" #luajit not available
license="BSD-2 GPL-2 LGPL-2.1 ZLIB"
depends="dbus fontconfig lz4-libs openssl glib libjpeg-turbo fribidi giflib
	libpng tiff libwebp gst-plugins-base avahi eudev bullet
	libsndfile libmount luajit poppler librsvg libspectre libraw harfbuzz tslib
	libxkbcommon libinput libxcomposite libxcursor libxinerama libxrandr
	libxtst libxscrnsaver"
depends_dev="mesa-dev fontconfig-dev lz4-dev glib-dev libjpeg-turbo-dev
	fribidi-dev giflib-dev libpng-dev tiff-dev libwebp-dev
	gst-plugins-base-dev avahi-dev eudev-dev bullet-dev
	alsa-lib-dev libsndfile-dev luajit-dev poppler-dev librsvg-dev
	vlc-dev libspectre-dev libraw-dev harfbuzz-dev wayland-protocols wayland-dev
	tslib-dev libxkbcommon-dev libinput-dev libxcursor-dev libxcomposite-dev
	libxinerama-dev libxrandr-dev libxtst-dev libxscrnsaver-dev
	elogind-dev pulseaudio-dev"
makedepends="$depends_dev autoconf automake dbus-dev openssl-dev doxygen bash texlive"
options="!check suid" # no testsuite and suid binaries
subpackages="$pkgname-dev $pkgname-doc $pkgname-lang"
source="https://download.enlightenment.org/rel/libs/$pkgname/$pkgname-$pkgver.tar.xz
	musl.patch"
builddir="$srcdir/$pkgname-$pkgver"

build() {

	# Some armhf chips doesn't have NEON
	case "${CARCH}" in
	armhf*)	DISABLE_NEON="--disable-neon" ;;
	esac


	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var \
		--enable-multisense \
		--enable-image-loader-webp \
		--enable-liblz4 \
		--enable-harfbuzz \
		--disable-systemd \
		--enable-pulseaudio \
		$DISABLE_NEON \
		--enable-fb \
		--enable-drm \
		--enable-gl-drm \
		--enable-elput \
		--enable-elogind \
		--with-opengl=es \
		--enable-egl \
		--enable-wayland \
		--enable-wayland-ivi-shell \
		--with-x \
		--enable-xinput22 \
		--with-x11=xlib
	make

	cd doc
	doxygen
}

package() {
	make -j1 DESTDIR="$pkgdir" install
}

doc() {
	default_doc
	install -d "${subpkgdir}/usr/share/doc/${pkgname}"
	cp -a "$builddir"/doc/html "${subpkgdir}/usr/share/doc/${pkgname}/html"
	cp -a "$builddir"/doc/latex "${subpkgdir}/usr/share/doc/${pkgname}/latex"
}

sha512sums="7385b1fdeee0a4565a0765fedbe5cecca81b86b306ee95a703b3064a88427ab0b4967f6f075a92f5c1d5911cefc56a9c2d45c7347572480169e3f53348321734  efl-1.22.2.tar.xz
42db5361fb58a14a39ac850dcc2fa4cb6d257e65b7dc23baacfb41f1bbb0158be0f7798793882bd7f7736d789f10d4d585138db7655356f7a18069bf44f30315  musl.patch"
